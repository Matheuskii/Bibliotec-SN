<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - BiblioTec</title>
    
    <link rel="stylesheet" href="./css/Inicio.css">
    <link rel="stylesheet" href="./css/Admin.css">
    <link rel="stylesheet" href="./css/Toast.css">
    <script src="./JS/toast.js" defer></script>
    
    <script src="./JS/admin.js" type="module" defer></script>

    <script>
        // Evita o "piscar" branco ao carregar
        if (localStorage.getItem('DarkMode') === 'true') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
</head>

<body>
    <div id="toast-box"></div>

    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="./images/LogoBibliotec.png" alt="Logo" class="admin-logo">
                <h3>Painel do Admin</h3>
                <button class="dark-mode-toggle" id="dark-mode-btn" title="Modo escuro">üåô</button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" onclick="mostrarSecao('livros')">üìö Livros</a>
                <a href="#" class="nav-link" onclick="mostrarSecao('alunos')">üéì Alunos</a>
                <a href="#" class="nav-link" onclick="mostrarSecao('reservas')">üìÖ Reservas</a>
                <a href="Inicio.html" style="margin-top: 40px; text-decoration: none;">üè† Ver Site</a>
                <a href="#" id="btnSairAdmin">üö™ Sair</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <h2 id="tituloSecao">Controle de Livros</h2>
                <div class="user-info">
                    <span id="adminNome">Admin</span>
                </div>
            </header>

            <section id="secao-livros" class="content-section">
                <div class="actions-bar">
                    <input type="text" id="buscaLivro" placeholder="Filtrar por nome, categoria ou autor...">
                    <button class="btn-novo" onclick="abrirModalLivro()">+ Novo Livro</button>
                </div>
                <div class="table-responsive">
                    <table class="tabela-admin">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Capa</th>
                                <th>T√≠tulo</th>
                                <th>Autor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaLivrosBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="secao-alunos" class="content-section" style="display: none;">
                <div class="actions-bar">
                    <input type="text" id="buscaAluno" placeholder="Buscar aluno..." class="search-admin">
                    <button class="btn-novo" onclick="abrirModalAluno()">+ Novo Aluno</button>
                </div>
                <div class="table-responsive">
                    <table class="tabela-admin">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Curso</th>
                                <th>Celular</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaAlunosBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="secao-reservas" class="content-section" style="display: none;">
                <div class="table-responsive">
                    <table class="tabela-admin">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Aluno</th>
                                <th>Livro</th>
                                <th>Retirada</th>
                                <th>Devolu√ß√£o</th>
                                <th>Status</th> <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaReservasBody"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="modalLivro" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTituloLivro">Novo Livro</h3>
            <form id="formLivro">
                <input type="hidden" id="livroId">
                <div class="form-group"><label>T√≠tulo (Nome)*</label><input type="text" id="titulo" required></div>
                <div class="form-row">
                    <div class="form-group"><label>Escritor (Autor)*</label><input type="text" id="autor" required></div>
                    <div class="form-group"><label>Editora</label><input type="text" id="editora"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Categoria (G√™nero)</label><input type="text" id="genero"></div>
                    <div class="form-group"><label>Idioma</label><input type="text" id="idioma" value="Portugu√™s"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Ano</label><input type="number" id="ano_publicacao"></div>
                    <div class="form-group"><label>ISBN</label><input type="text" id="isbn"></div>
                </div>
                <div class="form-group"><label>Foto (URL da Capa)</label><input type="text" id="caminho_capa"></div>
                <div class="form-group"><label>Descri√ß√£o (Sinopse)</label><textarea id="sinopse" rows="3"></textarea></div>
                <div class="form-group"><label><input type="checkbox" id="ativo" checked> Livro Ativo </label></div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharModal('modalLivro')">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalAluno" class="modal-overlay">
        <div class="modal-content">
            <h3>Cadastrar Aluno</h3>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 15px;">
                Nota: O aluno ser√° cadastrado sem senha. Uma senha provis√≥ria ser√° gerada.
            </p>
            <form id="formAluno">
                <div class="form-group"><label>Nome Completo*</label><input type="text" id="nomeAluno" required></div>
                <div class="form-group"><label>E-mail Institucional*</label><input type="email" id="emailAluno" required></div>
                <div class="form-row">
                    <div class="form-group"><label>Data Nascimento</label><input type="date" id="nascAluno" required></div>
                    <div class="form-group"><label>Celular</label><input type="text" id="celularAluno" required></div>
                </div>
                <div class="form-group"><label>Curso T√©cnico*</label><input type="text" id="cursoAluno" required></div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharModal('modalAluno')">Cancelar</button>
                    <button type="submit" class="btn-salvar">Cadastrar Aluno</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const perfil = localStorage.getItem("perfilUsuario");
            
            // Verifica√ß√£o de Seguran√ßa
            if (!perfil || perfil !== 'Admin') {
                // Se o showToast ainda n√£o estiver carregado, usa alert como fallback
                if (typeof showToast === "function") {
                    showToast("Acesso restrito a Administradores.", "error");
                } else {
                    alert("Acesso restrito a Administradores.");
                }
                
                setTimeout(() => {
                    window.location.href = "Login.html";
                }, 2000); // D√° tempo de ler o toast antes de chutar
            }
        });
    </script>

    <script>
        (function () {
            const darkModeBtn = document.getElementById('dark-mode-btn');
            const htmlElement = document.documentElement;

            const isDarkMode = localStorage.getItem('DarkMode') === 'true';

            if (isDarkMode) {
                htmlElement.classList.add('dark-mode');
                if (darkModeBtn) darkModeBtn.textContent = '‚òÄÔ∏è';
            }

            if (darkModeBtn) {
                darkModeBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const isCurrentlyDark = htmlElement.classList.contains('dark-mode');

                    if (isCurrentlyDark) {
                        htmlElement.classList.remove('dark-mode');
                        darkModeBtn.textContent = 'üåô';
                        localStorage.setItem('DarkMode', 'false');
                    } else {
                        htmlElement.classList.add('dark-mode');
                        darkModeBtn.textContent = '‚òÄÔ∏è';
                        localStorage.setItem('DarkMode', 'true');
                    }
                });
            }
        })();
    </script>
</body>
</html>